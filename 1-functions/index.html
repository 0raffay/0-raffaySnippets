<style>
    .box {
        height: 50px;
        width: 50px;
        display: block;
        background-color: #999;
    }

    .red {
        background-color: red;
    }

    .orange {
        background-color: orange;
    }

    .blue {
        background-color: blue;
    }

    .flex {
        display: flex;
        gap: 29px;
        align-items: center;
        justify-content: center;
        height: 300px;
    }
</style>

<button rf-tabbing-button="a">a</button>
<button rf-tabbing-button="B">b</button>

<div class="flex">
    <div class="box red" rf-tabbing-target="a" rf-tabbing-group-by="1">1</div>
    <div class="box blue" rf-tabbing-target="a" rf-tabbing-group-by="2">2</div>
</div>
<div class="flex">
    <div class="box red" rf-tabbing-target="b">1</div>
    <div class="box blue" rf-tabbing-target="b" style="display: none">2</div>
</div>

<script>
    class rfTabbing {
        constructor(
            {
                button = "rf-tabbing-button",
                target = "rf-tabbing-target",
                groupBy = "rf-tabbing-group-by",
                nothingOnActive = false,
                initialHide = false,
                initialHideAll = false,
                preventDefault = true,
            } = {},
            onHide
        ) {
            this.buttonSelector = button;
            this.targetSelector = target;
            this.groupBySelector = groupBy;

            this.initialHide = initialHide;
            this.initialHideAll = initialHideAll;
            this.nothingOnActive = nothingOnActive;

            this.buttons = [
                ...document.querySelectorAll(`[${this.buttonSelector}]`),
            ];
            this.targets = this.setTargets();

            this.addEventOnButton();
        }

        addEventOnButton() {
            this.buttons.forEach((b) => {
                b.addEventListener("click", (e) => {
                    if (this.preventDefault) {
                        e.preventDefault();
                    }

                    const targets = this.returnMatchingTargets(e.target);
                    if (!targets) {
                        return;
                    }

                    console.log("matching targets", targets);

                    const groupByError = this.checkIfBelongToSameGroup(targets);
                    if (groupByError) {
                        console.error(
                            "Some targets belong to different groups please assign targets to same group."
                        );
                        return;
                    }

                    this.toggle(targets);
                });
            });
        }

        toggle(targets) {
            const hidden = this.checkIfHidden(targets);
            targets.forEach((t) => {
                if (hidden) {
                    t.target.style.display = "block";
                } else {
                    t.target.style.display = "none";
                }
            });
        }

        returnMatchingTargets(button) {
            const s = button
                .getAttribute(this.buttonSelector)
                .toLowerCase()
                .trim();
            const matchingTargets = this.targets.filter((t) => {
                return (
                    t.target
                        .getAttribute(this.targetSelector)
                        .toLowerCase()
                        .trim() == s
                );
            });
            return matchingTargets.length ? matchingTargets : false;
        }

        checkIfBelongToSameGroup(targets) {
            const firstGroup = targets[0].group;
            return !targets.every((t) => t.group === firstGroup);
        }

        checkIfHidden(targets) {
            return targets.some((t) => t.target.style.display == "none");
        }

        setTargets() {
            const targets = [];
            document
                .querySelectorAll(`[${this.targetSelector}]`)
                .forEach((t) => {
                    targets.push({
                        target: t,
                        group: t.getAttribute(this.groupBySelector)
                            ? t.getAttribute(this.groupBySelector)
                            : null,
                    });
                });
            return targets;
        }
    }

    const tab = new rfTabbing();
</script>
